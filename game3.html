<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>å°éŠæˆ²3</title>
  <style>
    body {
      margin: 0;
      background: transparent;
      font-family: 'Noto Sans TC', sans-serif;
      color: white;
      text-align: center;
    }

    .stars {
      position: fixed;
      width: 100%;
      height: 100%;
      background: url('https://raw.githubusercontent.com/BonBonChou/Dora/main/images/stars.jpeg') repeat-y center center / cover;
      animation: scrollStars 60s linear infinite;
      z-index: 0;
      opacity: 0.8;
    }

    @keyframes scrollStars {
      from { background-position: 0 0; }
      to { background-position: 0 1000px; }
    }

    .hidden { display: none; }

    button {
      margin: 1em;
      padding: 0.75em 2em;
      font-size: 1.2em;
      border-radius: 12px;
      border: none;
      cursor: pointer;
      background: #1e90ff;
      color: white;
      transition: background 0.3s ease;
    }

    button:hover {
      background: #63b3ed;
    }

    .container {
      position: relative;
      z-index: 1;
      padding: 10vh 2em 2em;
      max-width: 600px;
      margin: auto;
    }

    h1 {
      font-size: 2.5em;
      margin-bottom: 0.2em;
    }

    h4 {
      font-size: 1.8em;
      color: #00ffcc;
      margin-top: 0;
      margin-bottom: 1em;
    }

    h5 {
      font-size: 1.1em;
      color: #b5fff0;
      margin-bottom: 1em;
    }

    .intro {
      text-align: justify;
      background: rgba(255,255,255,0.05);
      padding: 1em;
      width: fit-content;     /* æ ¸å¿ƒï¼šè‡ªå‹•æ ¹æ“šå…§å®¹å¯¬åº¦èª¿æ•´ */
      max-width: 100%;        /* é˜²æ­¢å¤ªé•·æ™‚è¶…å‡ºç•«é¢ */
      border-radius: 10px;
      margin: 0 auto 1.5em auto;  /* æ°´å¹³ç½®ä¸­ */
      margin-bottom: 1.5em;
      font-size: 1.4em;
    }

    .rules p {
      text-align: left;
      line-height: 1.6em;
    }

    .color-dot {
      display: inline-block;
      width: 14px;
      height: 14px;
      border-radius: 50%;
      vertical-align: middle;
      margin-right: 6px;
    }

    .blue { background: #4ec3ff; }
    .gold { background: #ffd24e; }
    .red { background: #ff5b5b; }

    #game-area {
      position: relative;
      width: 100%;
      height: 90vh;
      overflow: hidden;
      z-index: 1;
    }

    #lanes {
      position: absolute;
      width: 100%;
      height: 100%;
      top: 10%;
      background: linear-gradient(to right,
          rgba(255, 255, 255, 0.04) 0%,
          rgba(255, 255, 255, 0.04) 49.5%,
          rgba(0, 255, 255, 0.2) 49.5%,
          rgba(0, 255, 255, 0.2) 50.5%,
          rgba(255, 255, 255, 0.04) 50.5%,
          rgba(255, 255, 255, 0.04) 100%
      );
      z-index: 0;
      pointer-events: none;
    }


    .hud {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 2em;
      font-size: 2.5em;
      z-index: 3;
    }
    .hud > div {
      white-space: nowrap;
      min-width: 120px;
    }

    /* ç”Ÿå‘½é¡¯ç¤º */
    .heart {
      color:#ff7676;
      font-size:1.1em;
      margin-left:2px
    }
    /* å¤ªç©ºèˆ¹ & æ‰è½ç‰© -------------------------------------------------------- */
    .spaceship {
      position:absolute;
      width:225px;
      height:225px;
      bottom:0%;
      left:25%;
      transform:translateX(-50%);
      z-index:2;
      transition:left .15s
    }
    .spaceship img {
      width:100%;
      height:100%;
      object-fit:contain;
      pointer-events:none
    }

    .item {
      position:absolute;
      width:75px;
      height:75px;
      border-radius:50%;
      display:flex;
      justify-content:center;
      align-items:center;
      font-weight:bold;
      user-select:none;
      pointer-events:none
    }
    .item.fuel {
      background:#4ec3ff;
      box-shadow:0 0 10px #4ec3ff
    }
    .item.fuel img {
      width:100%;
      height:100%;
      object-fit:contain
    }
    .item.bomb {
      background:#ff4d4d;
      box-shadow:0 0 12px #ff4d4d
    }
    .item.bomb img {
      width:100%;
      height:100%;
      object-fit:contain
    }
    /* å½ˆå‡ºå‹•ç•« */
    @keyframes pop{
      to {
        transform:scale(1.5);opacity:0
      }
    }

    .fuel-status {
      font-weight: bold;
      color: #00ccff;
      margin-top: 0.5em;
      margin-bottom: 1em;
    }

  </style>
</head>
<body>

  <div class="stars"></div>

  <!-- Tutorial ------------------------------------------------------------ -->
  <div id="tutorial-screen" class="container">
    <h1>è£œå……ç‡ƒæ–™</h1>
    <h4>é»æ“Šè¢å¹•åˆ‡æ›å·¦å³ï¼Œæ’¿ç‡ƒæ–™é¿ç‚¸å½ˆï¼</h4>
    <p id="fuel" class="fuel-status"></p>
    <div class="intro">
      <p>ğŸ›¢ï¸â€¯ç‡ƒæ–™ã€€+20<br>ğŸ’£â€¯ç‚¸å½ˆã€€-1â€¯â¤ï¸</p>
      <p>â¤ï¸æ­¸é›¶ï¼ŒéŠæˆ²çµæŸ</p>
    </div>
    <button onclick="startGame()">é–‹å§‹éŠæˆ²</button>
  </div>

  <!-- Game ---------------------------------------------------------------- -->
  <div id="game-screen" class="hidden">
    <div class="hud">
      <div>ç‡ƒæ–™ï¼š<span id="fuel-num">0</span></div>
      <div>ç”Ÿå‘½ï¼š<span id="life-num"></span></div>
    </div>
    <div id="game-area">
      <div id="lanes"></div>
      <div id="ship" class="spaceship">
        <img src="https://raw.githubusercontent.com/BonBonChou/Dora/main/images/ship.jpg">
      </div>
    </div>
  </div>

  <!-- End ----------------------------------------------------------------- -->
  <div id="end-screen" class="container hidden">
    <h1>è£œçµ¦å®Œæˆï¼</h1>
    <h4>å‰©é¤˜ <span id="final-fuel"></span> ç‡ƒæ–™</h4>
    <button onclick="location.href='intro3.html'">å‡ºç™¼ï¼</button>
  </div>

  <!-- Fail ---------------------------------------------------------------- -->
  <div id="fail-screen" class="container hidden">
    <h1>ç‡ƒæ–™ä¸è¶³ï¼</h1>
    <h4>è«‹é‡æ–°è£œçµ¦ã€‚</h4>
    <button onclick="restartGame()">é‡æ–°é–‹å§‹</button>
  </div>

  <script>
    /* å…¨å±€å¸¸æ•¸ -------------------------------------------------------------- */
    const LANE_LEFT = 'left', LANE_RIGHT = 'right';
    const ITEM_INTERVAL = 900;        // ç”Ÿæˆé »ç‡ (ms)
    const ITEM_FALL_SPEED = 3;        // åˆå§‹è½ä¸‹é€Ÿåº¦ (px/å¸§)
    const SPEED_GAIN = 0.002;         // æ¯å¸§åŠ é€Ÿåº¦
    const FUEL_GAIN = 20;
    const LIFE_START = 3;

    /* DOM ------------------------------------------------------------------ */
    const tut = document.getElementById('tutorial-screen');
    const game = document.getElementById('game-screen');
    const end  = document.getElementById('end-screen');
    const fail = document.getElementById('fail-screen');
    const fuelEl = document.getElementById('fuel-num');
    const lifeEl = document.getElementById('life-num');
    const finalFuel = document.getElementById('final-fuel');
    const area = document.getElementById('game-area');
    const ship = document.getElementById('ship');

    /* ç‹€æ…‹ ------------------------------------------------------------------ */
    let lane = LANE_LEFT;
    let fuel = parseInt(localStorage.getItem('fuel')||'0');
    let life = LIFE_START;
    let items = [];
    let spawnTimer, animId;
    let currentSpeed = ITEM_FALL_SPEED;
    let spawnDelay = 900; // åˆå§‹é–“éš”

    /* åˆå§‹åŒ– ---------------------------------------------------------------- */
    window.addEventListener("DOMContentLoaded", () => { // ç•«é¢è¼‰å…¥å®Œæˆå¾ŒåŸ·è¡Œ
      document.getElementById("fuel").textContent = `å‰©é¤˜ ${fuel} ç‡ƒæ–™`;
    });

    function startGame(){
      tut.classList.add('hidden');
      game.classList.remove('hidden');
      fuelEl.textContent = fuel;
      renderLife();
      lane = LANE_LEFT;
      ship.style.left = '25%';
      spawnLoop();
      area.addEventListener('click', switchLane);
      animId = requestAnimationFrame(update);

      setInterval(() => {
        currentSpeed += 0.3;  // æ¯ç§’åŠ é€Ÿ
      }, 1000);
    }

    function spawnLoop() {
      spawnItem();
      spawnDelay = Math.max(spawnDelay - 15, 180); // æ¯æ¬¡ç”Ÿæˆé–“éš”ç¸®çŸ­ï¼Œæœ€ä½ 180 ms
      console.log(spawnDelay);
      spawnTimer = setTimeout(spawnLoop, spawnDelay);
    }
    

    /* ç”Ÿæˆç‰©ä»¶ -------------------------------------------------------------- */
    function spawnItem(){
      const type = Math.random() < 0.3 ? 'bomb' : 'fuel';
      const div = document.createElement('div');
      div.className = `item ${type}`;
      div.dataset.type = type;
      div.dataset.lane = Math.random() < 0.5 ? LANE_LEFT : LANE_RIGHT;
      div.style.left = div.dataset.lane===LANE_LEFT? '25%' : '75%'; // å·¦è»Šé“ï¼Œç‰©å“çš„ left å±¬æ€§ç‚º 25%ï¼šå³è»Šé“ï¼Œå‰‡ç‚º 75%
      div.style.transform = 'translateX(-50%)';
      div.style.top = '-80px';
      div.style.backgroundSize='contain';
      div.innerHTML = type==='fuel'
        ? '<img src="https://raw.githubusercontent.com/BonBonChou/Dora/main/images/battery.png">'
        : '<img src="https://raw.githubusercontent.com/BonBonChou/Dora/main/images/bomb.png">';
      area.appendChild(div);
      items.push({el:div, y:-80, speed:currentSpeed}); // el: ç‰©å“çš„ DOM å…ƒç´  (div)
    }

    /* éŠæˆ²ä¸»å¾ªç’° ------------------------------------------------------------ */
    function update(){
      items.forEach ( obj=>{
        obj.speed += SPEED_GAIN;
        obj.y += obj.speed;
        obj.el.style.top = obj.y+'px';

        // ç¢°æ’æª¢æ¸¬ï¼šåŒè»Šé“ä¸”è·é›¢ < 60px
        if (
          obj &&
          obj.el &&
          obj.el.dataset &&
          obj.el.dataset.collected !== "true" &&
          obj.el.dataset.lane === lane &&
          obj.y > area.offsetHeight * 0.8 - 60
        ) {
          obj.el.dataset.collected = "true";
          handleHit(obj.el.dataset.type);
          obj.el.style.animation = 'pop .3s forwards';
        }

        // ç§»å‡ºç•«é¢åˆªé™¤
        if ( obj.y > area.offsetHeight + 80 ) {
          obj.el.remove();
        }
      });
      items = items.filter ( i => i. y <= area.offsetHeight + 80 );
      if ( life > 0 ) {
        animId = requestAnimationFrame(update);
      }
    }

    /* äº‹ä»¶è™•ç† -------------------------------------------------------------- */
    function switchLane(){
      lane = lane === LANE_LEFT ? LANE_RIGHT : LANE_LEFT;
      ship.style.left = lane === LANE_LEFT? '25%' : '75%';
    }

    function handleHit(type){
      if (type==='fuel'){
        fuel += FUEL_GAIN;
        fuelEl.textContent=fuel;
      } else { // bomb
        life--;
        renderLife();
        if (life <= 0) gameOver();
      }
    }

    function renderLife(){
      if (life >= 0){
        lifeEl.innerHTML = 'â¤ï¸'.repeat(life);
      }
    }

    /* çµæŸæµç¨‹ -------------------------------------------------------------- */
    function gameOver(){
      clearInterval(spawnTimer);
      cancelAnimationFrame(animId);
      area.removeEventListener('click', switchLane);
      // æ¸…å ´
      items.forEach(obj => obj.el.remove());
      items=[];
      game.classList.add('hidden');
      if (fuel >= 600) {
        localStorage.setItem('fuel', fuel);
        finalFuel.textContent = fuel;
        end.classList.remove('hidden');
      } else {
        fail.classList.remove('hidden');
      }
    }

    function restartGame(){
      fail.classList.add('hidden');
      currentSpeed = ITEM_FALL_SPEED;
      spawnDelay = 900;
      fuel = parseInt(localStorage.getItem('fuel')||'0');
      life = 3;
      startGame();
    }
  </script>

</body>
</html>
